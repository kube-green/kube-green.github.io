"use strict";(self.webpackChunkkube_green_github_io=self.webpackChunkkube_green_github_io||[]).push([[2092],{8109:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"installation/cloud-provider","title":"Cloud compatibility","description":"GKE","source":"@site/docs/installation/cloud-provider.md","sourceDirName":"installation","slug":"/installation/cloud-provider","permalink":"/docs/installation/cloud-provider","draft":false,"unlisted":false,"editUrl":"https://github.com/kube-green/kube-green.github.io/edit/main/docs/installation/cloud-provider.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Install","permalink":"/docs/installation/install"},"next":{"title":"RBAC","permalink":"/docs/installation/rbac"}}');var r=o(4848),i=o(8453);const s={sidebar_position:2},l="Cloud compatibility",a={},c=[{value:"GKE",id:"gke",level:2},{value:"AWS EKS",id:"aws-eks",level:2}];function d(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"cloud-compatibility",children:"Cloud compatibility"})}),"\n",(0,r.jsx)(t.h2,{id:"gke",children:"GKE"}),"\n",(0,r.jsx)(t.p,{children:"When Google configures the control plane for a private cluster, they automatically configure VPC peering between your Kubernetes cluster network and a separate Google-managed project."}),"\n",(0,r.jsxs)(t.p,{children:["To restrict what Google is able to access in your cluster, the firewall rules configured restrict access to your Kubernetes pods. This means that the webhook won't work, and you will see an error like ",(0,r.jsx)(t.code,{children:"Internal error occurred: failed calling webhook ...:"})]}),"\n",(0,r.jsx)(t.p,{children:"So, to use the webhook component with a GKE private cluster, you need to configure an additional firewall rule to allow the GKE control plane to access your webhook pod."}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.em,{children:"kube-green"})," uses a webhook (exposed on port 9443) to check that the SleepInfo CRD is valid. In order to make it work, you must open port 9443 (or change the exposed port by configuration); otherwise, it will not be possible to add the SleepInfo CRD."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"https://cloud.google.com/kubernetes-engine/docs/how-to/private-clusters#add_firewall_rules",children:"Here"})," you can read more information about how to add firewall rules to GKE."]}),"\n",(0,r.jsx)(t.h2,{id:"aws-eks",children:"AWS EKS"}),"\n",(0,r.jsx)(t.p,{children:"When using a custom CNI on EKS (such as cilium), the webhook cannot be reached by kube-green. This happens because the control plane cannot be configured to run on a custom CNI, so the CNIs differ between the control plane and worker nodes."}),"\n",(0,r.jsxs)(t.p,{children:["To address this, set ",(0,r.jsx)(t.code,{children:"hostNetwork: true"})," in the deployment of the webhook to run it in the host network."]}),"\n",(0,r.jsxs)(t.p,{children:["To set this, uncomment the\xa0",(0,r.jsx)(t.code,{children:"# - host_network_patch.yaml"})," line (",(0,r.jsx)(t.a,{href:"https://github.com/kube-green/kube-green/blob/main/config/default/kustomization.yaml",children:"in this file"}),") to apply the patch with the ",(0,r.jsx)(t.code,{children:"hostNetwork: true"})," value."]})]})}function u(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>l});var n=o(6540);const r={},i=n.createContext(r);function s(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);